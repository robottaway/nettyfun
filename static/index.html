<html>
<head>
    <title>Netty Fun!</title>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
</head>
<body>
<script>
var authurl = "http://mb.blueleftistconstructor.com:8082/user/auth";
var wsurl = 'ws://farm.blueleftistconstructor.com:8080/ws';
var ws = null;
$(document).ready(function($) {
	// setup calls for credential based CORs
	var methods = ['POST', 'PUT', 'DELETE'];
	$.each(methods, function(i, method) {
		$.ajaxSetup({
	        type: "POST",
	        data: {},
	        dataType: 'json',
	        xhrFields: {
	           withCredentials: true
	        },
	        crossDomain: true
	    });
	});

    function registerWebsocket(ws, i) {
    	var ctr = 0;
    	ws.onmessage = function(e) {
    		ctr++;
    		if (ctr % 2 == 0) {
    			$('div#msg').text(e.data);
    		}
    		else {
    			$('div#ctr').text(e.data);
    		}
        };
        
        ws.onopen = function(e) {
            ws.send(i+': Now we begin');
        }
    }
    
    $.post(authurl, function(data) {
    	for (i = 0; i < 20; i++) {
    		registerWebsocket(new WebSocket(wsurl), i);
    	}
    }); // get auth cookie
});
</script>
<div id="ctr">0</div>
<div id="msg">hi</div>
</body> 
</html>